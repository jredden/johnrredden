<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="keywords"
	content="Hawaii,
	Coffee,
	ZenredComputing, 
	Globalization, 
	ScienceFiction,
	RideAStarShip,
	StarSystemSimulation"
/>

<link href="../css/main.css" rel="stylesheet" type="text/css">

<script src="../js/jquery-3.0.0.min.js" type="text/javascript"></script>
<script type="text/javascript" src="../js/jquery.form.js"></script>
<script type="text/javascript" src="../js/buckets.js"></script>
<script type="text/javascript" src="../js/cosmosCommon.js"></script>

<script type="text/javascript">

const CHANCE_FOR_STAR_ON_START = 0.1;	// one in ten

var tagOperations = (function(){
	// private
	var showOperations = [
	  	       			function shipStartSect(){
		   					$('#shipStart').show();
		   					$('#firstposition').show();
		   				},
		   				function cosmosSpaceDetail(){
		   					$('#cosmosspacedetail').show();
		   				},
		   				function jumping(){
		   					$('#comments').show();
		   					$('#jumping').show();
		   				},
		   				function starsinclustertext(){
		   					$('#starsinclustertextcanvas').show();
		   				},
		   				function backToSector(){
		   					$('#reEnterSector').show();
		   				},
		   				function backToStarSystem(){
		   					$('#reEnterStarSystem').show();
		   				},
		   				function backToPlanetSystem(){
		   					$('#reEnterPlanetSystem').show();
		   				}

	                  	];
	var hideOperations = [
		  	       			function shipStartSect(){
			   					$('#shipStart').hide();
			   					$('#firstposition').hide();
			   				},
			   				function cosmosSpaceDetail(){
			   					$('#cosmosspacedetail').hide();
			   				},
			   				function jumping(){
			   					$('#jumping').hide();
			   					$('#comments').hide();
			   				},
			   				function starsinclustertext(){
			   					$('#starsinclustertextcanvas').hide();
			   				},
			   				function backToSector(){
			   					$('#reEnterSector').hide();
			   				},
			   				function backToStarSystem(){
			   					$('#reEnterStarSystem').hide();
			   				},
			   				function backToPlanetSystem(){
			   					$('#reEnterPlanetSystem').hide();
			   				}
			   				

	                  	];
	var references = {	
			"shipStart" : 0,
			"cosmosSpaceDetail" : 1,
			"jumping" : 2,
			"starsinclustertext" : 3,
			"backToSector" : 4,
			"backToStarSystem" : 5,
			"backToPlanetSystem" : 6
	}
	
	// public 
	return {
		show: function(showList){ 
			for(var idex = 0; idex < showList.length; idex++){
				console.log("show:" + showList[idex]);
				var token2 = references[showList[idex]];
				showOperations[token2]();
			}
		},
		hide: function(hideList){
			for (var idex = 0; idex < hideList.length; idex++){
				console.log("hide:" + hideList[idex]);
				var token2 = references[hideList[idex]];
				hideOperations[token2]();
			}
		},
		hideAll: function(){
			for(token in hideOperations){ 
				console.log("token:" + token);
				var op = hideOperations[token];
				op();
			}
		},
		both: function(showList, hideList){
			tagOperations.show(showList);
			tagOperations.hide(hideList);
		}
		
	}
}());	



$(document).ready(function() {
	// console.log("in ready");
	vizStars.setImageURL("http://www.johntreddenlocal.com/cosmos/graphics/stars/");
	tagOperations.hideAll();
	visualizeClustersOnCanvas.init();
	visualizeClustersOnCanvas.logPrint();  // sanity check
	vizStars.init();
	vizPlanars.init();
	moonViz.init();
	processPlanetAndMoonsDetail.init();
	
	$("#home").click(function(){
		window.location = "http://johntreddenlocal.com";
	});
	var showList = ['shipStart'];
	tagOperations.show(showList);
	firstStop.ship();
	
	$("#jump").click(function(){
		jumpRequest.jsonCall();
	});
	
	$("#starsystems").click(function(event){
		var clickedX = event.pageX - this.offsetLeft;
		var clickedY = event.pageY - this.offsetTop;
		console.log("SCALE CLICK EVENT:"+clickedX+"::"+clickedY);
		scaleViz.determineClick(clickedX, clickedY);
	});
	
	$("#starsinclustertextcanvas").click(function(event){
		var clickedX = event.pageX - this.offsetLeft;
		var clickedY = event.pageY - this.offsetTop;
		console.log("CLICK EVENT:"+clickedX+"::"+clickedY);
		clickableAstroObjectList.determineClick(clickedX, clickedY);
	});

	$("#reEnterSector").click(function(){
		backToSectorView.reenter();
	});
	
	$("#reEnterStarSystem").click(function(){
		backToStarView.reenter();
	});
	
	$("#reEnterPlanetSystem").click(function(){
		backToPlanetView.reenter();
	});
	
}); <!-- end ready -->

/**
 *  when the star ship activates it's drive
 */
var jumpRequest = (function () {
	return{
		jsonCall: function(){
			console.log("start jumpRequest");
			var showList = ['jumping'];
			var hideList = ['shipStart','cosmosSpaceDetail', 'starsinclustertext', 'backToSector', 'backToStarSystem', 'backToPlanetSystem'];
			tagOperations.both(showList, hideList);

			$.getJSON("http://www.localhost:8080/johntredden-1.0/starSystems.html",
					function(json){           // callback
						console.log("in jumpRequest");
						processJump.jsonProcess(json);
					}		
			);
		}
	}
})();



/**
 * returned JSON is broken.  A package name is embeded in the message so
 * it has to be parsed and fixed.
 */
var processJump = (function () {
	var doOperation = function(key, value, systemVizCentricInstance){
		
		// private

		var systemsOperations = [
			function distance(instance, val){
				instance.setDistanceToGalacticCentre(val);
				return false;
			},
			function ucoord(instance, val){
				instance.setUCoordinate(val);
				return false;
			},
			function vcoord(instance, val){
				instance.setVCoordinate(val);
				return false;
			},
			function name(instance, val){
				instance.setSystemName(val);
				return true;
			}
		                      ]
		var operationArray = {
				"distance_to_galaxy_centre" : 0,
				"ucoordinate" : 1,
				"vcoordinate" : 2,
				"systemName" : 3
		}
		
		return systemsOperations[operationArray[key]](systemVizCentricInstance, value);
	}
	
	
	var systemVizCentricArray;
	
	var parseBroken = function(printthis){
	    if($.isArray(printthis) || typeof(printthis) == 'object') {
	    	var instance = new systemVizCentric();
	        for(var i in printthis) {
	        	var element = "::"+printthis[i]+"::"+i+"::";
	        	var a_match = element.toString().match("[object Object]");
	        	// console.log("MATCH:"+a_match);
	        	if(a_match != 'o'){
	        		var entry = element.split("::");
		        	console.log("ENTRY"+ entry[0]+ "|" + entry[1]+ "|" + entry[2]);
		        	var last = doOperation(entry[2], entry[1], instance);
		        	if(last){
		        		systemVizCentricArray.push(instance);
		        		instance = new systemVizCentric();
		        	}
	        	}
	            parseBroken(printthis[i]);
	        }
	    }
	}
	/**
	* wait for Cluster key values pairs from domain tier.  Hey.  It's AJAX.  
	*/
	var clusterTimerLoop = function(clusterTimer){
		console.log("WAITING FOR CLUSTER DATA");
		if(clusterValues.getDone()){
			window.clearInterval(clusterTimer)
			console.log("CLUSTER VALUES SIZE:"+clusterValues.getClusterVizCentricArraySize());
			console.log("SYSTEM TO CLUSTER SIZE:"+clusterValues.getSystemNameArraySize());
			clusterValues.builder();
			var showList = ['starsinclustertext'];
			tagOperations.show(showList);
			visualizeClusters.display();
			visualizeStarsInClusters.display();
		}
	}
	// public
	return{
		jsonProcess: function(json){
			systemVizCentricArray = [];
			parseBroken(json);
			var showList = ['cosmosSpaceDetail'];
			var hideList = ['shipStart','jumping', 'starsinclustertext'];
			tagOperations.both(showList, hideList);
			// async returns go into this object
			starSystems.visualize(systemVizCentricArray);
			var clusterTimer = setInterval(function () {clusterTimerLoop(clusterTimer)}, 1000);
			
		},
		getSystemVizCentricArrayLength: function(){
			return systemVizCentricArray.length;
		},
		getSystemVizCentricArray: function(){
			return systemVizCentricArray;
		}
	}
})();

/**
 * return to the previous sector view
 */
var backToSectorView = (function (){
	
	return{
		reenter: function(){
			var hideList = ['backToSector', 'backToStarSystem', 'backToPlanetSystem'];
			tagOperations.hide(hideList);
			
			canvasas.clearStarSystemsCanvasContext();
			canvasas.clearStarsInClusterTextCanvasContext();
			canvasas.init();
			var systemVizCentricArray = processJump.getSystemVizCentricArray();
			starSystems.vizualizeNoInit(systemVizCentricArray);
			clusterValues.builder();
			var showList = ['starsinclustertext'];
			tagOperations.show(showList);
			visualizeClusters.display();
			visualizeStarsInClusters.display();

		}
	}
	
})();

var backToStarView  = (function (){
	
	return{
		reenter: function(){
			var hideList = ['backToStarSystem','backToPlanetSystem'];
			tagOperations.hide(hideList);
			
			canvasas.clearStarSystemsCanvasContext();
			canvasas.clearStarsInClusterTextCanvasContext();
			canvasas.init();
			scaleViz.setModePlanets();
			processStarAndPlanetsDetail.f_drawStarInCentre();
			processStarAndPlanetsDetail.f_drawPlanetoidsAroundStar();
			processStarAndPlanetsDetail.f_drawStarDetails();
			
		}
	}
	
})();

var backToPlanetView = (function(){
	
	return{
		reenter: function(){
			var hideList = ['backToPlanetSystem'];
			tagOperations.hide(hideList);
			canvasas.clearStarSystemsCanvasContext();
			canvasas.clearStarsInClusterTextCanvasContext();
			canvasas.init();
			scaleViz.setModeMoons();
			var planetName = sessionStorage.PLANET_NAME;  // restore via database
			var starName = sessionStorage.STAR_NAME;
			fetchPlanetAndMoons.jsonCall(planetName, starName);
		}
	}
	
})();

var clusterDetailReuquest = (function () {
	return{
		jsonCall: function(systemName){
			$.getJSON("http://www.localhost:8080/johntredden-1.0/starCluster.html?systemName="+systemName,
					function(json){           // callback
						console.log("in clusterDetailRequest for :" + systemName);
						processClusterDetail.jsonProcess(json, systemName);
					}		
			);
		}
	}
})();

var processClusterDetail = (function () {
	
	// private
	
	
	// public
	return{
		jsonProcess: function(json, systemName){
			clusterValues.initArrays(systemName);
			for (var idex = 0; idex < json.stars.stars.length; idex++){
				if(json.stars.stars[idex].string != undefined){
					console.log(systemName + " STARS IN CLUSTER:"+systemName+ ":: "+ json.stars.stars[idex].string);
					var orderedPairArray = orderedPairToArray.getOrderedPair(json.stars.stars[idex].string);
					// console.log("ORDERED PAIR ARRAY:"+orderedPairArray);
					clusterValues.addToclusterVizCentricArray(orderedPairArray);
					clusterValues.storeVizCentricArray(systemName);
				}
			}
			clusterValues.setDone();
		}
	}
	
})();

/**
 * must be reinitliazed for each jump into a star system
 *
 * cvCoordinates has already been instantiated and initialized.
 */
var clusterViewCoordinatesToSystemName = (function (){
	// private
	var systemNameCoordinatesDictionary;
	
	return {
		initArrays: function(){	// sic ... dictionaries
			systemNameCoordinatesDictionary = new buckets.Dictionary(); 
		},
		process: function(systemName, cvCoordinates){
			systemNameCoordinatesDictionary.set(systemName, cvCoordinates);
		},
		fetchCVCoordinates(systemName){
			return systemNameCoordinatesDictionary.get(systemName);
		},
		fetchSystemNames(){
			return systemNameCoordinatesDictionary.keys();
		}
	}
	
})();

/**
 * build cluster values for visualizatrion after system matrix visualized.
 */
var clusterValues = (function () {
	// private
	var clusterVizCentricArray;
	var systemDictionary = new buckets.Dictionary();
	var starDictionary;
	var rawDictionary;
	
	var currentSystem;
	var workingClusterVizCentric;
	var currentStarKey;
	
	var done;
	
	var setOperations = [
	                     function setInstance(systemName){
	                    	 starDictionary = new buckets.Dictionary();
	                    	 systemDictionary.set(systemName, starDictionary);
	                    	 // console.log("SYSTEM DICTIONARY init for:" + systemName + "starDictionary:" + systemDictionary.get(systemName));
	                     },
	                     function setSubClusterDescription(description){
	                    	 // the first star attribute
	                    	 workingClusterVizCentric.setSubClusterDescription(description.toString());
	                    	 console.log("SUBCLUSTER_DESCRIPTION:"+description.toString());
	                     },
	                     function setAnglenInRadians(angle){
	                    	 workingClusterVizCentric.setAnglenInRadians(angle);
	                     	 console.log("ANGLE_IN_RADIANS:"+angle.toString());
	                  	                     },
	                     function setDistanceClusterVirtCentre(distance){
	                  	     workingClusterVizCentric.setDistanceClusterVirtCentre(distance);
	                    	 console.log("DISTANCE CENTRE:"+distance.toString());
	                     },
	                     function setLuminosity(lumens){
	                    	 workingClusterVizCentric.setLuminosity(lumens);
	                    	 console.log("LUMENS:"+lumens.toString());
	                     },
	                     function setStarName(name){
	                    	 workingClusterVizCentric.setStarName(name);
	                    	 currentStarKey = name;
	                    	 console.log("STAR_NAME:"+name.toString());
	                     },
	                     function setStarColor(color){
	                    	 workingClusterVizCentric.setStarColor(color);
	                    	 console.log("STAR_COLOR:"+color.toString());
	                     },
	                     function setStarSize(size){
	                    	 workingClusterVizCentric.setStarSize(size);
	                    	 console.log("STAR_SIZE:"+size.toString());
	                     },
	                     function setStarType(type){
	                    	 workingClusterVizCentric.setStarType(type);  // last star attribute, save cluster viz centric
	                    	 var starDict = systemDictionary.get(currentSystem);
	                    	 starDict.set(currentStarKey, workingClusterVizCentric);
	                    	 console.log("STAR_TYPE:"+type.toString()+" ADDING:"+currentStarKey+":: "+workingClusterVizCentric.getStarName());
	                    	 workingClusterVizCentric = new clusterVizCentric();
	                     },
	                     function setRename(){
	                    	 // none yet
	                     }
	                    ];
	
						var references = {
								"instance" : 0,
								"sub_cluster_description" : 1,
								"angle_in_radians_s" : 2,
								"distance_clust_virt_centre" : 3,
								"luminosity" : 4,
								"Name" : 5,
								"star_color" : 6,
								"star_size" : 7,
								"star_type" : 8,
								"renameName" : 9,
						}
	return{
		initArrays: function(systemName){
			setOperations[references["instance"]](systemName);
			clusterVizCentricArray = [];
			workingClusterVizCentric = new clusterVizCentric();
		},
		addToclusterVizCentricArray: function(keyValuePairArray){
			console.log("KEY VALUE PAIR ARRAY:"+keyValuePairArray[0].getKey()+":: "+ keyValuePairArray[0].getValue());
			clusterVizCentricArray.push(keyValuePairArray);
		},
		storeVizCentricArray: function(systemName){
			rawDictionary.set(systemName, clusterVizCentricArray);
			console.log("SAVING clusterVizCentricArray for SYSTEM:"+systemName);
			clusterVizCentricArray = [];
		},
		getClusterVizCentricArraySize(){
			return clusterVizCentricArray.length;
		},
		getSystemNameArraySize(){
			return rawDictionary.size();
		},
		builder(){
			
			var systemNameArray =  rawDictionary.keys();
			for(var idex = 0; idex <  systemNameArray.length; idex++){
				currentSystem = systemNameArray[idex];
				console.log(" BUILD SYSTEM:" + currentSystem);
				var rawClusterArray = rawDictionary.get(currentSystem);

				for(var idex2 = 0; idex2 < rawClusterArray.length; idex2++){  
					var pairs = rawClusterArray[idex2];
					for(var idex3 = 0; idex3 < pairs.length; idex3++){
						setOperations[references[pairs[idex3].getKey()]](pairs[idex3].getValue());
					}
				}
			}
			console.log("ALL SYSTEMS BUILT");
		},
		fetchProcessedCluster(){
			return systemDictionary;
		},
		reset(){
			systemDictionary = new buckets.Dictionary();
			rawDictionary = new buckets.Dictionary();
		},
		clearDone(){
			done = false;
		},
		setDone(){
			done = true;
		},
		getDone(){
			return done;
		}

	}
	
})();
var visualizeClusters = (function (){
	
	// public
	return{
		display : function(){
			visualizeClustersOnCanvas.resetTextDictionary();
			var ctx = canvasas.fetchStarsInClusterTextCanvasContext();
			ctx.fillRect(5,20,700, window.innerHeight);
			ctx.beginPath();
			var startX = 5;
			var startY = 50;
			var runningX = startX;
			var runningY = startY;
			var incrementY = 20;
			var subClusterDescription;
			var starName;
			var starColor;
			var starSize;
			var starLuminosity;

			
			var dictionary = clusterValues.fetchProcessedCluster();
			var systemsWithClusters = dictionary.keys();
			ctx.font="18px Verdana";
			ctx.strokeStyle = "orange";
			ctx.strokeText("Star Systems in this Sector", runningX, runningY);
			runningY += incrementY;
			for(var idex = 0; idex < systemsWithClusters.length; idex++){
				var clusterVizCentrics = dictionary.get(systemsWithClusters[idex]);
				console.log("SYSTEM WITH CLUSTER:"+systemsWithClusters[idex]);
				var system = systemsWithClusters[idex];
				var starDict = dictionary.get(system);
				var stars = starDict.keys();
				var previousSystem;
				for(var idex2 = 0; idex2 < stars.length; idex2++){
					console.log("STAR WITH VIZ CENTRIC:"+stars[idex2]);
					var oneClusterVizCentric = starDict.get(stars[idex2]);	
					console.log("SubClusterDescription:"+oneClusterVizCentric.getSubClusterDescription());
					console.log("AnglenInRadians:"+oneClusterVizCentric.getAnglenInRadians());
					console.log("DistanceClusterVirtCentre:"+oneClusterVizCentric.getDistanceClusterVirtCentre());
					console.log("Luminosity:"+oneClusterVizCentric.getLuminosity());
					console.log("StarName:"+oneClusterVizCentric.getStarName());
					console.log("StarColor:"+oneClusterVizCentric.getStarColor());
					console.log("StarSize:"+oneClusterVizCentric.getStarSize());
					console.log("StarType:"+oneClusterVizCentric.getStarType());
					
					var starPoint = visualizeClustersOnCanvas.locateScaleUsingDistance(oneClusterVizCentric.getDistanceClusterVirtCentre(), oneClusterVizCentric.getAnglenInRadians());
					var starPointXVector = starPoint.getX();
					var starPointYVector = starPoint.getY();
					visualizeClustersOnCanvas.saveSystemClusterVizScalar(starPointXVector, starPointYVector, system, oneClusterVizCentric.getStarName(), oneClusterVizCentric.getStarColor());
					console.log("STAR POINTS " + starPointXVector + " AND " + starPointYVector + " IN " + system + " SYSTEM");
					
					subClusterDescription = oneClusterVizCentric.getSubClusterDescription();
					starName = "StarName:"+oneClusterVizCentric.getStarName();
					starColor = "StarColor:"+oneClusterVizCentric.getStarColor()+ " ";
					starSize = "StarSize:"+oneClusterVizCentric.getStarSize() + " ";
					starLuminosity = "Luminosity:"+oneClusterVizCentric.getLuminosity();
					ctx.font="16px Verdana";
					ctx.strokeStyle = "yellow";
					if(previousSystem != system){
						runningY += incrementY;
						ctx.strokeText("SYSTEM WITH CLUSTER:"+system, runningX, runningY);
						runningY += incrementY;
					}
					previousSystem = system;
					ctx.font="10px Verdana";
					ctx.strokeStyle = "lightblue";
					ctx.strokeText("SubClusterDescription:"+subClusterDescription, runningX, runningY);
					runningY += incrementY;
					ctx.strokeText(starName, runningX, runningY);
					
					var o_point = new point();
					o_point.setXandY(runningX, runningY);  // saved for larger star images to select
					visualizeClustersOnCanvas.saveStarTextGeometry(oneClusterVizCentric.getStarName(), o_point);
					
					runningY += incrementY;
					ctx.strokeText(starColor, runningX, runningY);
					var colorWidth = ctx.measureText(starColor).width;
					runningX += colorWidth ;
					ctx.strokeText(starSize, runningX, runningY);
					var luminosityWidth = ctx.measureText(starSize).width;
					runningX += luminosityWidth;
					
					visualizeClustersOnCanvas.saveMaxX(runningX);  // used to properly space larger star image.
					
					ctx.strokeText(starLuminosity, runningX, runningY);
					runningY += incrementY;

					runningX = startX;

				}
			}
		}
	}
	
})();

var visualizeStarsInClusters = ( function (){
	var previousCtx;
	var nextCtx;
	var systemNames;
	const leanLeft = 200;
	const beginY = 50;
	return{
		display: function(){
			previousCtx = canvasas.fetchStarSystemsCanvasContext();
			systemNames = visualizeClustersOnCanvas.fetchSystemNames();
			for(var idex = 0; idex < systemNames.length; idex++){
				var systemName = systemNames[idex];
				var starsDictionary = visualizeClustersOnCanvas.fetchSystemClusterVizScalar(systemName);
				var starKeys = starsDictionary.keys();  // star names are these keys
				for(var idex2 = 0; idex2 < starKeys.length; idex2++){
					var o_starVizElement = starsDictionary.get(starKeys[idex2]);
					var a_relativeSystemVector = o_starVizElement.fetchRelativeSystemVector();
					var starColor = o_starVizElement.fetchStarColor();
					var vizStarSizes = vizStars.fetchStarSizeAndColor(starColor);
					var cvCoordinates = clusterViewCoordinatesToSystemName.fetchCVCoordinates(systemName);
					var o_middlePoint = cvCoordinates.getMiddlePoint();
					
					var size = vizStarSizes.fetchSmallSize();
					var color = vizStarSizes.fetchColor();
					var startx = o_middlePoint.getX() + a_relativeSystemVector.getScalarX();
					var starty = o_middlePoint.getY() + a_relativeSystemVector.getScalarY();
					
					console.log("SYSTEM:"+systemName +" VISUALIZE STARS IN CLUSTERS X COORDINATES:"+o_middlePoint.getX()+"::"+a_relativeSystemVector.getScalarX());
					console.log("SYSTEM:"+systemName + " VISUALIZE STARS IN CLUSTERS Y COORDINATES:"+o_middlePoint.getY()+"::"+a_relativeSystemVector.getScalarY());
					
					previousCtx.beginPath();
					previousCtx.arc(startx, starty, size, 0, 2*Math.PI, false);
					previousCtx.fillStyle = color;
					previousCtx.fill();
					previousCtx.lineWidth=0;
					previousCtx.stroke();

				}
			}
			// to do: make this more object oriented.  It violates the D.R.Y. principal
			clickableAstroObjectList.init();
			clickableAstroObjectList.setStarsAndPlanets();
			var currentCanvasCtx = canvasas.fetchStarsInClusterTextCanvasContext();
			visualizeClustersOnCanvas.genStarTextGeomteryWithMaxX();
			var starTextDictionary = visualizeClustersOnCanvas.fetchStarTextDictionary();
			currentCanvasCtx.font="18px Verdana";
			currentCanvasCtx.strokeStyle = "orange";
			var firstMessageWidth = currentCanvasCtx.measureText("Star Systems in this Sector                 ").width;
			currentCanvasCtx.strokeText("Select Star By Star Image", firstMessageWidth, beginY);

			for(var idex = 0; idex < systemNames.length; idex++){
				var systemName = systemNames[idex];
				var starsDictionary = visualizeClustersOnCanvas.fetchSystemClusterVizScalar(systemName);
				var starKeys = starsDictionary.keys();
				for(var idex2 = 0; idex2 < starKeys.length; idex2++){
					var o_starVizElement = starsDictionary.get(starKeys[idex2]);
					var starColor = o_starVizElement.fetchStarColor();
					var vizStarSizes = vizStars.fetchStarSizeAndColor(starColor);
					var o_textPointOnPage = starTextDictionary.get(starKeys[idex2]);
					var size = vizStarSizes.fetchBigSize()*2;
					var color = vizStarSizes.fetchColor();
					var xDim = o_textPointOnPage.getX();
					var yDim = o_textPointOnPage.getY();
					var graphicXDim = xDim + size + leanLeft;
					currentCanvasCtx.beginPath();
					currentCanvasCtx.arc(graphicXDim, yDim, size, 0, 2*Math.PI, false);
					currentCanvasCtx.fillStyle = color;
					currentCanvasCtx.fill();
					currentCanvasCtx.lineWidth=0;
					currentCanvasCtx.stroke();
					clickableAstroObjectList.addImageGeometry(graphicXDim, yDim, size, starKeys[idex2]);
				}
			}

		}
	}
	
})();

/**
 * used to draw the initial canvas
 */
var draw = (function(){
	
	// private
	var sizes = [5,4,4,3,3,3,3,2,2,2,2,2];
	var colors = ['white', 'lightblue', 'blue', 'lightyellow', 'yellow', 'orange', 'red', '#580058']
	var sizesLength = sizes.length;
	var colorsLength = colors.length;
	
	// public
	return {
		sizeStar: function(){
			var index_s = Math.floor(Math.random() * sizesLength);
			return sizes[index_s];
		},
		color: function(){
			var index_c = Math.floor(Math.random() * colors.length);
			return colors[index_c];
		},
		chance: function(){
			var randomNumber = Math.random();
			// console.log("randomNumber:"+randomNumber);
			if(randomNumber < CHANCE_FOR_STAR_ON_START){
				return true;
			}
			else{
				return false;
			}
		}
	}
}()); <!-- end draw -->

/*
 * When opening the page, this is the start point
 */
var firstStop = (function () {
	return{
		ship: function(){
			console.log("ship outside cosmos");
			var canvas = document.getElementById("firstposition");
			var ctx = canvas.getContext("2d");
			ctx.canvas.width = window.innerWidth;
			ctx.canvas.height = window.innerHeight;
			ctx.fillStyle = "#00003D";
			ctx.fillRect(0,20,window.innerWidth, window.innerHeight);
			
			var startx = 5;
			var starty = 15;
			
			while (starty < canvas.height){
				while(startx < canvas.width){
					var chance = draw.chance();
					if(chance){
						var size = draw.sizeStar();
						var color = draw.color();
						// console.log("size:" + size+ " color:" + color + " chance:" + chance);
						ctx.beginPath();
						ctx.arc(startx, starty, size, 0, 2*Math.PI, false);
						ctx.fillStyle = color;
						ctx.fill();
						ctx.lineWidth=0;
						ctx.stroke();
					}
					startx += 7;
				}
				startx = 5;
				starty += 7;
			}
		}
	}
})();

var starSystems = (function () {
	// private
	var viz = function(systemVizCentricArray){
		var ctx = canvasas.fetchStarSystemsCanvasContext();
		ctx.fillRect(0,20,window.innerWidth/2, window.innerHeight);
		
		var lineWidth = 2;
		var flipFlop = 0;
		var startX = 50;
		var startY = 50;
		var incrementHeaderX = 20;
		var widthBoxY= 150;
		var widthBoxX = 150
		var runningX = startX;
		var runningY = startY;
		var fillStyle;
		var reset;
		console.log("LENGTH:"+systemVizCentricArray.length);
		ctx.beginPath();
		for(var idex = 0; idex < systemVizCentricArray.length; ){
			clusterValues.initArrays(systemVizCentricArray[idex].getSystemName());
			if(flipFlop == 0){
				fillStyle = 'darkblue';
			}
			else{
				fillStyle = 'midnightblue';
			}
			ctx.rect(runningX, runningY, widthBoxX, incrementHeaderX);
			ctx.fillStyle = fillStyle;
			ctx.fillRect(runningX, runningY, widthBoxX, incrementHeaderX);
			ctx.lineWidth= lineWidth;
			ctx.strokeStyle= "lightblue";
			ctx.stroke();
			
			var cvCoordinates = new clusterViewCoordinates();
			cvCoordinates.setAttributesFromRectangle(runningX, runningY, widthBoxX, widthBoxY);
			console.log("STAR SYSTEM:"+systemVizCentricArray[idex].getSystemName()+" CVCOORDINATES:"+cvCoordinates.getTopLeftX()
					+"|"+cvCoordinates.getTopLeftY()
					+"|"+cvCoordinates.getBottomRightX()
					+"|"+cvCoordinates.getBottomRightY());
			cvCoordinates.getMiddlePoint().logPrint();
				
			clusterViewCoordinatesToSystemName.process(systemVizCentricArray[idex].getSystemName(),cvCoordinates);
			
			var header = "U"+systemVizCentricArray[idex].getUCoordinate()+":V"+systemVizCentricArray[idex].getVCoordinate();
			// console.log("HEADER:"+header);
			ctx.font="16px Verdana";
			ctx.strokeText(header, runningX+2, runningY+15);
			clusterValues.clearDone();
			clusterDetailReuquest.jsonCall(systemVizCentricArray[idex].getSystemName());
			
			runningY += incrementHeaderX;
			
			if(flipFlop == 0){
				fillStyle = 'midnightblue';
			}
			else{
				fillStyle = 'darkblue';
			}
			ctx.rect(runningX, runningY, widthBoxX, widthBoxY);
			ctx.fillStyle = fillStyle;
			ctx.fillRect(runningX, runningY, widthBoxX, widthBoxY);
			ctx.lineWidth= lineWidth;
			ctx.strokeStyle= "lightblue";
			ctx.stroke();
			
			runningY -= incrementHeaderX;
			
			flipFlop ^=1;
			runningX+=widthBoxX;
			++idex;
			reset = idex % 5;
			if(reset == 0){
				runningX = startX;
				runningY += widthBoxY;
			}
		}
		ctx.closePath();
	}
	
	return{
		visualize: function(systemVizCentricArray){
			clusterValues.reset();  // reinitilizes top dictionary
			visualizeClustersOnCanvas.reset();
			clusterViewCoordinatesToSystemName.initArrays();
			
			canvasas.init();
			viz(systemVizCentricArray);
		},
		vizualizeNoInit: function(systemVizCentricArray){
			viz(systemVizCentricArray);
		}
	}
})();

var visualizeClustersOnCanvas = (function () {
	
	// private
	
	var distancePartitionMinConstant = 904398;  // sample closest cluster to centre
	var distancePartitionMaxConstant = 5004938249;  // sample farthest cluster from centre 
	var distanceIncrement = Math.floor(distancePartitionMaxConstant/distancePartitionMinConstant);
	
	var dictionaryPartitioning = 30;
	var distanceStep = distanceIncrement/dictionaryPartitioning;
	var pixelIncrement = 5;
	var incrementsDictionary;
	var clustersDictionary;
	var starsDictionary;
	var starTextDictionary;
	var workDictionary;
	var maxX;
	
	
	// public
	
	return{
		reset: function(){
			clustersDictionary = new buckets.Dictionary();	
		},
		resetTextDictionary: function(){
			starTextDictionary  = new buckets.Dictionary();
			maxX = 0;
		},
		init: function(){
			incrementsDictionary = new buckets.Dictionary();
						
			var increment = 0;
			for (var idex = 0; idex < dictionaryPartitioning; idex++){
				increment += pixelIncrement;
				var nextKey = Math.floor(distanceStep *  distancePartitionMinConstant * idex);
				incrementsDictionary.set(nextKey, increment);
			}
		},
		logPrint: function(){
			var keys = incrementsDictionary.keys();
			for(var idex = 0; idex < keys.length; idex++){
				var key = keys[idex];
				var value = incrementsDictionary.get(key);
				console.log("CLUSTER PARITION:"+value + " INCREMENT:" + key);
			}
		},
		locateScaleUsingDistance: function(distance, angle){	// distance in kilometers, angle in radians
			var pixelScalar;
			var keys = incrementsDictionary.keys();
			for(var idex = 0; idex < keys.length; idex++){
				var idex2 = idex + 1;
				if(idex2 == keys.length){
					pixelScalar = incrementsDictionary.get(keys[keys.length-1]);  // end of the keys
					break;
				}
				if(keys[idex]>= distance && keys[idex2] < distance){
					pixelScalar = incrementsDictionary.get(keys[idex]);
					break;
				}
			}
			pixelScalar = Math.floor(pixelScalar / 3);  // so as to compute from middle of the system visual.
			var pointFromCentre = scaledXandY.scaleToAngle(angle, pixelScalar);
			return pointFromCentre;
		},
		saveSystemClusterVizScalar: function(scalarX, scalarY, systemName, starsName, starColor){
			console.log("SAVE SYSTEM VIZ SCALAR:"+scalarX+"::"+scalarY+"::"+systemName+"::"+starsName+"::"+starColor+"::");
			if(!clustersDictionary.containsKey(systemName)){
				starsDictionary  = new buckets.Dictionary();
				clustersDictionary.set(systemName, starsDictionary)
			}
			starsDictionary = clustersDictionary.get(systemName);
			var o_starVizElements = new starVizElements();
			o_starVizElements.setScalarXandYandColor(scalarX, scalarY, starColor);
			starsDictionary.set(starsName, o_starVizElements);
			console.log("SAVE SYSTEM VIZ SCALAR KEYS:"+starsDictionary.keys());
		},
		fetchSystemClusterVizScalar: function(systemName){
			var o_starsDictionary = clustersDictionary.get(systemName);
			return o_starsDictionary;
		},
		fetchSystemNames: function(){
			return clustersDictionary.keys();
		},
		saveStarTextGeometry: function(starName, point){	// used to draw large selectable stars on page
			console.log("SAVE STAR TEXT GEOMETRY:"+starName+" X:"+point.getX()+" Y:"+point.getY());
			starTextDictionary.set(starName, point);
		},
		saveMaxX(xX){
			if( xX > maxX){
				maxX = xX;
			}
		},
		genStarTextGeomteryWithMaxX: function(){
			workDictionary = new buckets.Dictionary();
			var keys = starTextDictionary.keys();
			for(var idex = 0; idex < keys.length; idex++){
				var oo_point = starTextDictionary.get(keys[idex]);
				var o_point = new point();
				o_point.setXandY(Math.floor(maxX),oo_point.getY());
				workDictionary.set(keys[idex], o_point);
			}
		},
		fetchStarTextDictionary: function(){
			return workDictionary;
		}
	}
	
})();

/**
 * geometry to allow clickable stars, planets and moons on canvas
 */
var clickableAstroObjectList = (function(){
	
	var astroImageDictionary;
	const fudgeFactor = 3;  // close as in horseshoes ...
	
	var doTheAction;
	
	function action(nameAndKeys){
		doTheAction.init(nameAndKeys);
	}
	function starAndPlanetsAction(){
		doTheAction = starAndPlanets;
	}

	function planetAndMoonsAction(){
		doTheAction = planetAndMoons;
	}
	
	function moonsOnlyAction(){
		doTheAction = moonsOnly;
	}

	return{
		init: function(){
			astroImageDictionary = new buckets.Dictionary();
		},
		setStarsAndPlanets: function(){
			starAndPlanetsAction();
		},
		setPlanetAndMoons: function(){
			planetAndMoonsAction();
		},
		setMoonsOnly: function(){
			moonsOnlyAction();
		},
		addImageGeometry(xDim, yDim, radius, starName){
			var o_circle = new circle();
			o_circle.construct(xDim, yDim, radius);
			astroImageDictionary.set(starName, o_circle);
		},
		determineClick(clickedX, clickedY){
			var nameameKeys = astroImageDictionary.keys();
			for (var idex = 0; idex < nameameKeys.length; idex++){
				var o_circle = astroImageDictionary.get(nameameKeys[idex]);
				var bottom = o_circle.fetchBottom() + fudgeFactor;
				var top = o_circle.fetchTop() - fudgeFactor;
				var left = o_circle.fetchLeft() - fudgeFactor;
				var right = o_circle.fetchRight() + fudgeFactor;
				if(clickedX < right && clickedX > left && clickedY > top && clickedY < bottom){
					console.log("GOING TO:"+nameameKeys[idex] );
					action(nameameKeys[idex]);
				}
			}
		}
	}
	
})();

/**
 * visiualize star details and planets, if they exist.
 */
var starAndPlanets = (function(){
	
	return{
		init: function(starName){
			canvasas.clearStarSystemsCanvasContext();
			canvasas.clearStarsInClusterTextCanvasContext();
			var showList = ['backToSector'];
			tagOperations.show(showList);
			fetchStarAndPlanets.jsonCall(starName);
		}
	}
	
})();

var planetAndMoons = (function(){
	
	return{
		init: function(planetName){
			canvasas.clearStarSystemsCanvasContext();
			canvasas.clearStarsInClusterTextCanvasContext();
			var showList = ['backToStarSystem'];
			tagOperations.show(showList);
			var starName = sessionStorage.STAR_NAME;
			sessionStorage.setItem('PLANET_NAME', planetName);
			fetchPlanetAndMoons.jsonCall(planetName, starName);
		}
	}
	
})();

var moonsOnly = (function(){
	
	return{
		init: function(moonName){
			canvasas.clearStarSystemsCanvasContext();
			canvasas.clearStarsInClusterTextCanvasContext();
			var showList = ['backToPlanetSystem'];
			tagOperations.show(showList);
			var starName = sessionStorage.STAR_NAME;
			fetchMoons.jsonCall(moonName, starName);
		}
	}
	
})();

var fetchStarAndPlanets = (function () {
	return{
		jsonCall: function(starName){
			$.getJSON("http://www.localhost:8080/johntredden-1.0/starAndPlanets.html?starName="+starName,
					function(json){           // callback
						console.log("fetchStarAndPlanets for :" + starName);
						processStarAndPlanetsDetail.jsonProcess(json, starName);
					}		
			);
		}
	}

})();

var fetchPlanetAndMoons = (function () {
	return{
		jsonCall: function(planetName, starName){
			$.getJSON("http://www.localhost:8080/johntredden-1.0/planetAndMoons.html?starName="+starName+"&planetName="+planetName,
					function(json){           // callback
						console.log("fetch planets and moons for :" + planetName);
						processPlanetAndMoonsDetail.f_planetMode();
						processPlanetAndMoonsDetail.jsonProcess(json, planetName);
					}		
			);
		}
	}

})();

var fetchMoons = (function () {
	return{
		jsonCall: function(moonName, starName){
			$.getJSON("http://www.localhost:8080/johntredden-1.0/planetAndMoons.html?starName="+starName+"&planetName="+moonName,
					function(json){           // callback
						console.log("fetch moon :" + moonName);
						processPlanetAndMoonsDetail.f_moonMode();
						processPlanetAndMoonsDetail.jsonProcess(json, moonName);
					}		
			);
		}
	}

})();



var processPlanetAndMoonsDetail = (function(){
	var scale = 1.0;	// the default scale
	const DEGREE = "Degree";
	const DISTANCE_TO_PRIMARY = "DistanceToPrimary";
	const PERCENT_WATER = "PercentWater";
	const TEMPERATURE = "Temperature";
	const RADIUS = "Radius";
	const PLANAR_NAME = "planetoidName";
	const ACTION = "ACTION";
	const ATMOSPHERE = "ATMOSPHERE";
	const NO_MOON = "NO_MOON";
	const MOON = "MOON";
	const CHEM_NAME = "chem_name";
	const PERCENTAGE = "percentage";
	const CHEM_COLOR = "Chem_Color";
	const PERCENT = "Percent";
	const COLOR = "Color";
	const TEMPTYPE = "TempType";
	const SIZETYPE = "SizeType";

	
	const o_planarVizCentric = new planarVizCentric();
	const startX = 5;
	const startY = 50;
	const atmospherRectX = 250;
	const xOffset = 10;
	const imageX = 500;
	const incrementY = 20;
	const MOON_TO_EARTH = 384400.0;
	const ELIPSE_MOON_SCALAR = 22115.0*MOON_TO_EARTH;

	var o_moonPlanarVizCentric;
	var onePlanetDictionary;
	var o_colorPercentageSet;
	var o_atmosphereArray;
	var o_atmosphereSet;
	
	var planetAndMoonsDictionary;
	var moonsDictionary;
	var planetDictionary;
	
	var midX;
	var midY;
	
	var o_baseMessage;
	var moonNames;
	
	baseMessage = function(){
		var planarMessage;
		this.planarMessage = "error, not initialized";
		var emptyMessage;
		this.emptyMessage = "error, not initialized";
		var selectMessage;
		this.selectMessage = "error, not initialized";
		var fromMessage;
		this.fromMessage = "error, not initialized";
	}
	baseMessage.prototype.Planet = function(){
		this.planarMessage = "Planet";
		this.emptyMessage = "Planet does not have any moons";
		this.selectMessage = "Select Moon by Moon Image";
		this.fromMessage = "Star";
	}
	baseMessage.prototype.Moon = function(){
		this.planarMessage = "Moon";
		this.emptyMessage = "Moon does not have satellites";
		this.selectMessage = "No Satellites To Select";
		this.fromMessage = "Planet";
	}
	baseMessage.prototype.getMode = function(){
		return this.planarMessage;
	}
	baseMessage.prototype.getEmpty = function(){
		return this.emptyMessage;
	}
	baseMessage.prototype.getSelect = function(){
		return this.selectMessage;
	}
	baseMessage.prototype.getFrom = function(){
		return this.fromMessage;
	}
	
	function planetDegree(value){
		o_planarVizCentric.setPlanarDegree(value);
		console.log("planetDegree: "+ value);
	}
	
	function planetDistanceToPrimary(value){
		o_planarVizCentric.setPlanarDistanceToPrimary(value);
		console.log("planetDistanceToPrimary: "+ value);
	}
	
	function planetRadius(value){
		o_planarVizCentric.setPlanarRadius(value);
		console.log("planetRadius: "+ value);
	}
	
	function planetPercentWater(value){
		o_planarVizCentric.setPlanarPercentWater(value);
		console.log("planetPercentWater: "+ value);
	}
	
	function planetTemperature(value){
		o_planarVizCentric.setPlanarTemperature(value);
		console.log("planetTemperature: "+ value);
	}
	function tempType(value){
		console.log("tempType: "+ value);
		o_planarVizCentric.setPlanarTempType(value);
	}

	function sizeType(value){
		console.log("sizeType: "+ value);
		o_planarVizCentric.setPlanarSizeType(value);
	}
	
	function planetName(value){
		o_planarVizCentric.setPlanarName(value);
		console.log("planetName: "+ value);
	}
	
	function atmosphereChemName(value){
		o_atmosphereSet = new atmosphereSet();
		o_atmosphereSet.setChemical(value);
		console.log("planetAtmosphereChemName: "+ value);
	}

	function atmosphereChemPercentage(value){
		o_atmosphereSet.setPercentage(value);
		console.log("planetAtmosphereChemPercentage: "+ value);
	}
	
	function atmosphereChemColor(value){
		o_atmosphereSet.setColor(value);
		o_atmosphereArray.push(o_atmosphereSet)
		console.log("planetAtmosphereChemColor: "+ value);
	}
	
	function action(value){
		console.log("action: "+ value);
		if(value == 'NO_MOON'){
			console.log("No moons for this planar");
		}
		else{
			if(value == 'MOON'){
				planetAndMoonsDictionary = moonsDictionary;
			}
			else{
				if(value == 'ATMOSPHERE'){
					console.log("atmospheres coming");					
				}
				else{
					throw "Bad Action Value:"+value;
				}
			}
		}
	}
	
	function moonName(value){
		console.log("moonName: "+ value);
		o_moonPlanarVizCentric = new planarVizCentric();
		o_moonPlanarVizCentric.setPlanarName(value);
		onePlanetDictionary.set(value, o_moonPlanarVizCentric);
	}
	
	function moonDegree(value){
		o_moonPlanarVizCentric.setPlanarDegree(value);
		console.log("moonDegree: "+ value);
	}
	
	function moonRadius(value){
		o_moonPlanarVizCentric.setPlanarRadius(value);
		console.log("moonRadius: "+ value);
	}

	function moonDistanceToPrimary(value){
		o_moonPlanarVizCentric.setPlanarDistanceToPrimary(value);
		console.log("moonDistanceToPrimary: "+ value);
	}
	
	function moonTemperature(value){
		o_moonPlanarVizCentric.setPlanarTemperature(value);
		console.log("moonTemperature: "+ value);
	}
	
	function moonColor(value){
		o_colorPercentageSet = new colorPercentageSet();
		o_colorPercentageSet.setPlanarColor(value);
		console.log("moonColor: "+ value);
	}
	
	function moonColorPercentage(value){
		o_colorPercentageSet.setColorPercentage(value);
		o_moonPlanarVizCentric.addColorPercentage(o_colorPercentageSet);
		console.log("moonColorPercentage: "+ value);
	}

	function parseResults(result){
		planetDictionary = new buckets.Dictionary();
		moonsDictionary = new buckets.Dictionary();
		onePlanetDictionary = new buckets.Dictionary();	// all the moons around the planet
		o_atmosphereArray = [];
		
		planetAndMoonsDictionary = planetDictionary;	// planet messages come first
		planetDictionary.set(DEGREE, planetDegree);
		planetDictionary.set(DISTANCE_TO_PRIMARY, planetDistanceToPrimary);
		planetDictionary.set(PERCENT_WATER, planetPercentWater);
		planetDictionary.set(TEMPERATURE, planetTemperature);
		planetDictionary.set(PLANAR_NAME, planetName);
		planetDictionary.set(RADIUS, planetRadius);
		planetDictionary.set(TEMPTYPE, tempType);
		planetDictionary.set(SIZETYPE, sizeType);
		planetDictionary.set(ACTION, action);
		planetDictionary.set(CHEM_NAME, atmosphereChemName);
		planetDictionary.set(PERCENTAGE, atmosphereChemPercentage);
		planetDictionary.set(CHEM_COLOR, atmosphereChemColor);

		
		moonsDictionary.set(PLANAR_NAME, moonName);
		moonsDictionary.set(DEGREE, moonDegree);
		moonsDictionary.set(RADIUS, moonRadius);
		moonsDictionary.set(TEMPTYPE, tempType);
		moonsDictionary.set(SIZETYPE, sizeType);
		moonsDictionary.set(DISTANCE_TO_PRIMARY, moonDistanceToPrimary);
		moonsDictionary.set(TEMPERATURE, moonTemperature);
		moonsDictionary.set(COLOR, moonColor);
		moonsDictionary.set(PERCENT, moonColorPercentage);
		
		for (var idex = 0; idex < result.length; idex++){
			var o_keyValuePair = result[idex];
			var key = o_keyValuePair.getKey();
			// console.log("KEY:"+key);
			if(key === 'renameName'){
				continue;
			}
			var operation = planetAndMoonsDictionary.get(key);
			operation(o_keyValuePair.getValue());
		}
		
	}
	
	function drawPlanetInCentre(){
		var starsystemscanvasContext = canvasas.fetchStarSystemsCanvasContext();
		midX = starsystemscanvasContext.canvas.width/2;
		midY = starsystemscanvasContext.canvas.height/6;
		var radius = o_planarVizCentric.getPlanarRadius();
		var outerRadius = vizPlanars.fetchImageSize(radius);
		var gradientsArray = o_planarVizCentric.fetchGradients();
		processStarAndPlanetsDetail.f_circleGradient(starsystemscanvasContext, outerRadius, midX, midY, midX, midY, gradientsArray);

	}
	
	function drawPlanetDetails(){
		var planarType = o_baseMessage.getMode();
		var fromMessage = o_baseMessage.getFrom();
		var planarName = o_planarVizCentric.getPlanarName();
		var planarDegree = o_planarVizCentric.getPlanarDegree()*(180/Math.PI);  // radians to degrees
		var distanceToParentStar = o_planarVizCentric.getPlanarDistanceToPrimary();
		var temperature = o_planarVizCentric.getPlanarTemperature();	// kelvin
		var radius = o_planarVizCentric.getPlanarRadius();
		var percentageWater = o_planarVizCentric.getPlanarPercentWater();
		var tempType = o_planarVizCentric.getPlanarTempType();
		var sizeType = o_planarVizCentric.getPlanarSizeType();
		
		var ctx = canvasas.fetchStarsInClusterTextCanvasContext();
		var runningX = startX;
		var runningY = startY;
		
		ctx.font="18px Verdana";
		ctx.strokeStyle = "orange";
		ctx.strokeText(planarType +" "+planarName+" Details", runningX, runningY);
		runningY += incrementY;
		runningX = startX;
		var selectMessage = o_baseMessage.getSelect();
		ctx.strokeText(selectMessage, runningX, runningY);
		runningY += incrementY;
		runningX = startX;

		ctx.font="14px Verdana";
		ctx.strokeStyle = "lightblue";
		ctx.strokeText(planarType +" Angle from "+fromMessage+": "+planarDegree, runningX, runningY);
		runningY += incrementY;
		runningX = startX;
		ctx.strokeText(planarType +" Distance from "+fromMessage+": "+distanceToParentStar, runningX, runningY);		
		runningY += incrementY;
		runningX = startX;
		ctx.strokeText(planarType +" Temperature Kelvin: "+temperature, runningX, runningY);		
		runningY += incrementY;
		runningX = startX;
		ctx.strokeText(planarType + " Radius in Kilometers: "+radius, runningX, runningY);		
		runningY += incrementY;
		runningX = startX;
		ctx.strokeText(planarType + " Temperature Type: "+tempType, runningX, runningY);		
		runningY += incrementY;
		runningX = startX;
		ctx.strokeText(planarType + " Size Type: "+sizeType, runningX, runningY);		
		runningY += incrementY;
		runningX = startX;
		ctx.strokeText("Percentage Water of "+ planarType +": "+percentageWater*100, runningX, runningY);	
		
		runningY += incrementY;
		runningX = startX;
		if(moonNames.length == 0){
			var emptyMessage = o_baseMessage.getEmpty();
			ctx.strokeText(emptyMessage, runningX, runningY);
		}
		else{
			if(moonNames.length == 1){
				ctx.strokeText("Planet has one moon", runningX, runningY);
			}
			else{
				ctx.strokeText("Planet has "+ moonNames.length+ " moons", runningX, runningY);
			}
		}
		runningX = startX;
		runningY += incrementY;
		runningY += incrementY;
		runningY += incrementY;
		runningY += incrementY;
		var snatchY = runningY;
		for (var idex=o_atmosphereArray.length-1; idex > -1; idex--){
			var o_atmosphereSet = o_atmosphereArray[idex];
			var name = o_atmosphereSet.getChemical();
			var percent = Number(o_atmosphereSet.getPercentage())*100;
			var color = o_atmosphereSet.getColor();
			ctx.strokeText("Atmosphere: "+name, startX , runningY);	
			runningY += incrementY;
			ctx.strokeText("Percent: "+percent, startX , runningY);	
			runningY += incrementY;
			ctx.beginPath();
			ctx.fillStyle=color;
			var atmospherRectY = o_atmosphereSet.getYVisualSize(percent);
			ctx.fillRect(startX, runningY, atmospherRectX, atmospherRectY);
			ctx.stroke();
			runningY += atmospherRectY;
			runningY += incrementY;
		}
		if(moonNames.length > 0){
			console.log("NUMBER OF MOONS:"+moonNames.length);
			drawMoonSelectables(moonNames, snatchY);
			drawMoonsAroundPlanets(moonNames)
		}

	}
	
	function drawMoonsAroundPlanets(moonNames){
		var starsystemscanvasContext = canvasas.fetchStarSystemsCanvasContext();
		scaleViz.drawControls(starsystemscanvasContext);
		midX = starsystemscanvasContext.canvas.width/2;
		midY = starsystemscanvasContext.canvas.height/6;
		var o_clusterVizCentric = processStarAndPlanetsDetail.f_fetchClusterVizCentric();
		var starColor = o_clusterVizCentric.getStarColor();
		var starsystemscanvasContext = canvasas.fetchStarSystemsCanvasContext();
		for (var idex = 0; idex < moonNames.length; idex++){
			var o_moonPlanarVizCentric = onePlanetDictionary.get(moonNames[idex]);
			var distance = o_moonPlanarVizCentric.getPlanarDistanceToPrimary();
			var radiusOnPage = moonViz.computeMoonVizRadius(distance);
			var angleInDegrees = o_moonPlanarVizCentric.getPlanarDegree()*(180/Math.PI);
			o_point = new point();
			o_point.setXandY(midX, midY);
			ellipseWithPlanar.drawEllipseAndPlanar(o_point, radiusOnPage, angleInDegrees, starColor, starsystemscanvasContext);
		}
	}
	
	function drawMoonSelectables(moonNames, runningY){
		var ctx = canvasas.fetchNewStarAndPlanetsContext();
		clickableAstroObjectList.init();
		clickableAstroObjectList.setMoonsOnly();
		for(var idex = 0; idex < moonNames.length; idex++){
			var o_moonPlanarVizCentric = onePlanetDictionary.get(moonNames[idex]);
			o_moonPlanarVizCentric.buildGradients();
			var radius = o_moonPlanarVizCentric.getPlanarRadius();
			var outerRadius = vizPlanars.fetchImageSize(radius);
			var gradientsArray = o_moonPlanarVizCentric.fetchGradients();
			processStarAndPlanetsDetail.f_circleGradient(ctx, outerRadius, imageX, runningY, imageX, runningY, gradientsArray);

			clickableAstroObjectList.addImageGeometry(imageX, runningY, outerRadius, moonNames[idex]);
			runningY += (incrementY*6);
		}
	}
	
	return{
		init: function(){
			o_baseMessage = new baseMessage();
		},
		jsonProcess: function(json, planetName){
			var planetAndMoonsMessage = json.planets.planetAndMoons;
			console.log("PLANET AND MOONS MESSAGE:"+planetAndMoonsMessage);
			var result = orderedPairToArray.getOrderedPair(planetAndMoonsMessage);
			parseResults(result);
			moonNames = onePlanetDictionary.keys();	// early binding
			scaleViz.setModeMoons();
			drawPlanetDetails();
			drawPlanetInCentre();
		},
		f_drawPlanetDetails: function(){
			drawPlanetDetails();
		},
		f_drawPlanetInCentre: function(){
			drawPlanetInCentre();
		},
		f_drawMoons: function(){
			drawMoonsAroundPlanets(moonNames);
		},
		f_planetMode: function(){
			o_baseMessage.Planet();
		},
		f_moonMode: function(){
			o_baseMessage.Moon();
		},
		f_getMode: function(){
			o_baseMessage.getMode();
		}
		
	}
})();

/**
 * builds array of arrays holding ordered pairs
 */
var orderedPairToArray = (function (){
	return{
		getOrderedPair: function (oneString){
			var result = [];
			var stars = [];
			
			var arrayOfUnsplitOrderedPairs = oneString.toString().split(";");

			for(var idex = 0; idex < arrayOfUnsplitOrderedPairs.length; idex++){
				kvPair = new keyValuePair();
				var kvArray = arrayOfUnsplitOrderedPairs[idex].split("=");
				kvPair.setKey(kvArray[0]);
				kvPair.setValue(kvArray[1]);
				// console.log("KVPAIR:"+kvPair.getKey()+"::"+kvPair.getValue());
				result.push(kvPair);
			}
			return result;
		}
	}
})();


</script>

<title>Cosmos Website</title>
</head>
<body id="cosmosspace">
	<div id="wrapperspace">
			<header id="topHeaderFixed">
			<hgroup>
				<nav id="topNavCosmos">
					<button id="home">Home</button>
					<button id="jump">Activate Starships Star Drive</button>
			<!--  		<span id="jumphint" style="color:lightyellow;font-weight:bold">To travel to a new star system activate the Star Drive</span> -->
					<button id="reEnterSector">Re-Enter Sector</button>
					<button id="reEnterStarSystem">Re-Enter Star System</button>
					<button id="reEnterPlanetSystem">Re-Enter Planet System</button>
				</nav>
			</hgroup>
		</header>
	</div> <!--  wrapperspace -->
	<section id="cosmosspacedetail">
	<canvas id="starsystems">
	Your browser does not support the HTML5 canvas tag.
	Please upgrade to a version with full support for HTML5.
	
	</canvas>
	
	<canvas id="starsinclustertextcanvas">
	Your browser does not support the HTML5 canvas tag.
	Please upgrade to a version with full support for HTML5.
	
	</canvas>
	
	</section> <!-- end cosmosspacedetail -->
	
	<section id="shipstart">
	<canvas id="firstposition">
	Your browser does not support the HTML5 canvas tag.
	Please upgrade to a version with full support for HTML5.
	</canvas>
	
	</section> <!--  end shipstart -->
	<section>
	<div id="jumping">
	<img src="../JumpingToLightSpeed.gif" width="1360" height="1000" />
	</div>
		
	<div id="comments">
	The starship is using the star drive to<br/>
	enter a sector consisting of twenty five<br/>
	systems.  This can take several minutes.<br/>
	<br/>
	The sector is divided into systems, each<br/>
	labeled with a U and a V coordinate, which<br/>
	are the dimensions of each system in the<br/>
	star drives entry sequence.<br/>
	<br/>
	Some systems are empty or seemingly empty<br/>
	when viewing the sector map at the right<br/>
	hand part of the page. Each star viewed in<br/>
	sector map is listed in the middle of the<br/>
	page.  The name of the system is taken from<br/>
	its U and V coordinates of star ship entry.<br/>
	Each star has a Description, Name, Color,<br/>
	Radius in solar units and Luminosity.<br/>
	A Description of None designates a <br/>
	random collection of stars.<br/>
	<br/>
	To the far right of the page are the star<br/>
	images. Select the stars image to visualize<br/>
	the systems details.  Often a star will not<br/>
	have detected planets.<br/>
	<br/>
	Using a similar procedure, planets and their<br/> 
	moons can be selected.  The orbits scale of<br/>
	planets and moons can be increased or <br/>
	decreased using the scale controls.<br/>
	 
	</div>
	
	</section>
</body>
</html>