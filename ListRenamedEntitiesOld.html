<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<link href="../css/main.css" rel="stylesheet" type="text/css">

<script src="../js/jquery-3.0.0.min.js" type="text/javascript"></script>
<script type="text/javascript" src="../js/jquery.form.js"></script>
<script type="text/javascript" src="../js/buckets.js"></script>
<script type="text/javascript" src="../js/cosmosCommon.js"></script>
<script type="text/javascript">



/**
 * Named Entity Object, instantiate with new
 */
 var namedEntity = (function(){
	 
	 // private
	 // uDimension":77116,"vDimension":75958,"renameObjectType":"CLUSTER",
	 // "genericName":"Cluster.SINGLESTAR.77116.75958","renameName":"FelgerCarb"
	 	var uDimension;
	 	var vDimension;
	 	var renameObjectType;
	 	var genericName;
	 	var renamesArray = [];
	 	var renames_count = 0;
	 	var distanceToGalacticCentre;
	 	
	 // public
	 	
	 	return {
	 	
	 		setUDimension: function (_uDimension){
		 		uDimension = _uDimension;
		 	},
		 	
		 	getUDimension: function (){
		 		return uDimension;
		 	},
		 	
		 	setVDimension: function (_vDimension){
		 		vDimension = _vDimension;
		 	},
		 	
		 	getVDimension: function (){
		 		return vDimension;
		 	},
		 	
		 	setRenameObjectType: function (_renameObjectType){
		 		renameObjectType = _renameObjectType;
		 	},
		 	
		 	getRenameObjectType: function (){
		 		return renameObjectType;
		 	},
	
		 	setGenericName: function (_genericName){
		 		genericName = _genericName;
		 	},
		 	
		 	getGenericName: function (){
		 		return genericName;
		 	},
		 	
		 	addRename: function (_renameName){
				renamesArray[renames_count] = _renameName;
				++renames_count;
		 	},
		 	
		 	getRenamesArray: function (){
		 		return renamesArray;
		 	},
		 	
		 	setDistanceToGalacticCentre: function (_distanceToGalacticCentre){
		 		distanceToGalacticCentre = _distanceToGalacticCentre;
		 	},
		 	
		 	getDistanceToGalacticCentre: function (){
		 		return distanceToGalacticCentre;
		 	}
	 	}
 });

/**
 * makes sections appear and dissapear on the page
 */
var tagOperations = (function(){
	// private
	var showOperations = [
		function spinner(){
			$('#spinner').show();
		},
		function spinner2(){
			$('#spinner2').show();
		},
		function renameText(){
			$('#renameText').show();
		},
		function wrapperspace(){
			$('#wrapperspace').show();
		},
		function fsect(){
			$('#fsect').show
		}

    ];
	
	var hideOperations = [
		function spinner(){
			$('#spinner').hide();
		},
		function spinner2(){
			$('#spinner2').hide();
		},
		function renameText(){
			$('#renameText').hide();
		},
		function wrapperspace(){
			$('#wrapperspace').hide();
		},
		function fsect(){
			$('#fsect').hide
		}

	];
	
	var references = {
			"spinner" : 0
			,"spinner2" : 1
			,"renameText" : 2
			,"wrapperspace" : 3
			,"fsect" : 4
	}
	
	// public 
	return {
		show: function(showList){ 
			for(var idex = 0; idex < showList.length; idex++){
				console.log("show:" + showList[idex]);
				var token2 = references[showList[idex]];
				showOperations[token2]();
			}
		},
		hide: function(hideList){
			for (var idex = 0; idex < hideList.length; idex++){
				console.log("hide:" + hideList[idex]);
				var token2 = references[hideList[idex]];
				hideOperations[token2]();
			}
		},
		hideAll: function(){
			for(token in hideOperations){ 
				console.log("token:" + token);
				var op = hideOperations[token];
				op();
			}
		},
		both: function(showList, hideList){
			tagOperations.show(showList);
			tagOperations.hide(hideList);
		}
		
	}
}());	



var parseRenameStream  = (function(){
	
	// public
	
	return{
		cluster: function(){
			$('#spinner').show();
			$.getJSON("http://www.localhost:8080/johntredden-1.0/listRenamedEntities.html?objectType=CLUSTER",
					function(json){           // callback
						console.log("in cluster:"+json);
						$('#spinner').hide();
						processChoice.jsonProcessCluster(json);
					}
			);
			
		},
		star: function(){
			$('#spinner').show();
			$.getJSON("http://www.localhost:8080/johntredden-1.0/listRenamedEntities.html?objectType=STAR",
					function(json){           // callback
						console.log("in star:"+json);
						$('#spinner').hide();
						processChoice.jsonProcessStar(json);
					}
			);
			
		},
		planar: function(){
			$('#spinner').show();
			$.getJSON("http://www.localhost:8080/johntredden-1.0/listRenamedEntities.html?objectType=PLANETOID",
					function(json){           // callback
						console.log("in planetoids:"+json);
						$('#spinner').hide();
						processChoice.jsonProcessPlanetoid(json);
					}
			);
			
		}
	}

}());



var processChoice = (function(){
	
	// private
	    var lineArray = [];
		var parseRenamed = function(lineArray, type){
			displayButtons.action(lineArray, type);
		}
	
	// public
	
	return {
		jsonProcessCluster: function(json){
			lineArray = parseCandidates.parseStart(json);
			parseRenamed(lineArray, 'CLUSTER');
		},
		jsonProcessStar: function(json){
			lineArray = parseCandidates.parseStart(json);
			parseRenamed(lineArray, 'STAR');
		},
		jsonProcessPlanetoid: function(json){
			lineArray = parseCandidates.parseStart(json);
			parseRenamed(lineArray, 'PLANETOID');
		},
		
	}
	
})();

var parseCandidates = (function(){
	
	// private
	var lineArray = [];
	var lineCount = 0;
	var workingRenameLine;
	var state;
	var output;

	
	// public
	
	return{
		
		parseStart: function(stream){
			lineArray = [];
			lineCount = 0;
			output = '';
			return parseCandidates.parse(stream);
		},
		parse: function(stream){
		    if($.isArray(stream) || typeof(stream) == 'object') {
		        for(var idex in stream) {
		        	console.log("Next idex:" + idex);
		        	switch(idex){

		        	case "uDimension":
		        		workingNamedEntity = new namedEntity();
		        		state = 'start';
		        		break;
		        	
		        	case "vDimension":
		        		state = 'vDimension';
		        		break;
		        		
		        	case "renameObjectType":
		        		state = 'renameObjectType';
		        		break;
		        		
		        	case "genericName":
		        		state = 'genericName';
		        		break;
		        		
		        	case "renameName":
		        		state = 'renameName';
		        		break;
		        		
		        	case "distanceToGalacticCentre":
		        		state = 'distanceToGalacticCentre';
		        		break;
		        		
		        	default:
		        	}
		        	parseCandidates.parse(stream[idex]);
		        }
		    }else {
		    	console.log("Next stream:" + stream + " state:" + state);
		    	switch (state){
		    	
		    	case "start":
		    		workingNamedEntity.setUDimension(stream);
		    		break;
		    		
		    	case "vDimension":
		    		workingNamedEntity.setVDimension(stream);
		    		break;
		    		
		    	case "renameObjectType":
		    		workingNamedEntity.setRenameObjectType(stream);
		    		break;
		    		
		    	case "genericName":
		    		workingNamedEntity.setGenericName(stream);
		    		break;	    	

		    	case "renameName":
		    		workingNamedEntity.addRename(stream);
		    		break;
		    		
		    	case "distanceToGalacticCentre":
		    		workingNamedEntity.setDistanceToGalacticCentre(stream);
		    		lineArray[lineCount++] = workingNamedEntity;
		    		break;

		    	default:
		    		console.log("warning:" + state);
		    	}
		        
		    }
			return lineArray;   

		},
		getGenericName: function(index){
			return lineArray[index].getGenericName();
		}
	}
	
})();

var displayButtons = (function (){
	
	// private
	
	function displayAction(start, end, tag, renameArray, type){
		var dynamicHtml = "<br/> <br/>";
		$("div[id=space]").html(dynamicHtml);
		dynamicHtml = "";
		theXor = 0;
		var renameDisplay = "";

		for(var idex0 = start; idex0 < end; idex0++){
			var uDimension = renameArray[idex0].getUDimension();
			var vDimension = renameArray[idex0].getVDimension();
			var genericName = renameArray[idex0].getGenericName();
			var distanceToGalacticCentre = renameArray[idex0].getDistanceToGalacticCentre();
			var renames = [];
			renames = renameArray[idex0].getRenamesArray();
			for(var idex1 = 0; idex1 < renames.length; idex1++){
				
				if(0 == idex1){
					renameDisplay += " Renames:"
					renameDisplay += renames[idex1];
				}
				else{
					renameDisplay += ",";
					renameDisplay += renames[idex1];
				}
			}
			
			theXor ^=1;
			var bgColor = "lightblue";
			if(theXor){
				bgColor = "lightgreen";
			}
			entry.params("fdiv", type);
			dynamicHtml +="<div class=\"entry\"><button onclick=\"entry.action("+idex0+")\" style=\"width: 100%; text-align: left; background-color:" + bgColor + ";"
					+"\">"
					+ "Rename Name: " + "U" + uDimension + " V" + vDimension+ " " + renameDisplay
					+"</button></div>";
			var renameDisplay = "";
		}
		$("div[id^="+tag+"]").html(dynamicHtml);	}
	
	// public
	return{
		action: function(renameArray, type){
			$('#renameText').hide();
			var wholeOfIt = renameArray.length;
			var firstHalf = Math.floor(wholeOfIt/2);
			id="topRenameCosmosEntity"
			displayAction(0, firstHalf, "column1", renameArray, type);
			displayAction(firstHalf+1, wholeOfIt, "column2", renameArray, type);
			$('#renameText').show();
//			$('#wrapperspace').show();
		}
	}
	
})();

var entry = (function (){
	var result;
	var uri;
	var parsedURI;
	return{
		action: function(topu, topv, bottomu, bottomv){
			var showList = ['jumping'];
			tagOperations.show(showList);
			var hideList = ['spinner2', 'report', 'reportComments'];
			tagOperations.hide(hideList);
			var postWithParameters = "http://www.localhost:8080/johntredden-1.0/visitStarSystem.html?s_Ucoordinate_top="
					+ topu
					+ "&s_Vcoordinate_top="
					+ topv
					+ "&s_Ucoordinate_bottom="
					+ bottomu
					+ "&s_Vcoordinate_bottom="
					+ bottomv;
			var jqxr = $.post(postWithParameters, function() {
				result = $(".result");
				console.log("rawURI:"+result);
			})
			  .done(function(data) {
				  setInterval(function () {if(data != null){clearInterval();}}, 1000);	// arg! ajax
				  console.log( "second success:"+data );
				  sectorProcess.iterate(data);
				  })
			  .fail(function(xhr, status, error) {
			    alert( "error" + error);
			  })
			  .always(function() {
				  console.log( "finished" );
				var hideList = ['jumping'];
				tagOperations.hide(hideList);
			});
			
		},
		params: function(tag, type){
			theTag = tag;
			theType = type
			jSon = 0;
		},
	}

})();


var sectorProcess = (function (){
	
	var systemVizCentricArray;
	
	return{
		iterate: function(data){
			systemVizCentricArray = [];
			var modifiedJson = data.replace("com.zenred.cosmos.vizualization.SystemVizCentric", 
					"com_zenred_cosmos_vizualization_SystemVizCentric");
			var jsonObject = JSON.parse(modifiedJson);
			console.log("jsonObject:"+jsonObject.systems.systemVizCentrics[0].com_zenred_cosmos_vizualization_SystemVizCentric[0].systemName);
			for(var systemArray in jsonObject.systems.systemVizCentrics[0].com_zenred_cosmos_vizualization_SystemVizCentric){
				console.log("systemArray:"+ 
				jsonObject.systems.systemVizCentrics[0].com_zenred_cosmos_vizualization_SystemVizCentric[systemArray].systemName);
				var systemVizCentricInstance = new systemVizCentric();
				var name = jsonObject.systems.systemVizCentrics[0].com_zenred_cosmos_vizualization_SystemVizCentric[systemArray].systemName;
				systemVizCentricInstance.setSystemName(name);
				var ucoord = jsonObject.systems.systemVizCentrics[0].com_zenred_cosmos_vizualization_SystemVizCentric[systemArray].ucoordinate;
				systemVizCentricInstance.setUCoordinate(ucoord);
				var vcoord = jsonObject.systems.systemVizCentrics[0].com_zenred_cosmos_vizualization_SystemVizCentric[systemArray].vcoordinate;
				systemVizCentricInstance.setVCoordinate(vcoord);
				var distance = jsonObject.systems.systemVizCentrics[0].com_zenred_cosmos_vizualization_SystemVizCentric[systemArray].distance_to_galaxy_centre;
				systemVizCentricInstance.setDistanceToGalacticCentre(distance);
				systemVizCentricArray.push(systemVizCentricInstance);
			}
			visualizeClustersOnCanvas.init();
			visualizeClustersOnCanvas.logPrint();  // sanity check
			vizStars.init();
			vizPlanars.init();
			moonViz.init();
			processPlanetAndMoonsDetail.init();
			starSystems.visualize(systemVizCentricArray);
			var clusterTimer = setInterval(function () {clusterTimerLoop(clusterTimer)}, 1000);
		},
		getSystemVizCentricArray: function(){
			return systemVizCentricArray;
		}
	}
	
})();

/**
* wait for Cluster key values pairs from domain tier.  Hey.  It's AJAX.  
*/
var clusterTimerLoop = function(clusterTimer){
	console.log("WAITING FOR CLUSTER DATA");
	if(clusterValues.getDone()){
		window.clearInterval(clusterTimer)
		console.log("CLUSTER VALUES SIZE:"+clusterValues.getClusterVizCentricArraySize());
		console.log("SYSTEM TO CLUSTER SIZE:"+clusterValues.getSystemNameArraySize());
		clusterValues.builder();
		var showList = ['cosmosSpaceDetail', 'starsinclustertext'];
		var hideList = ['jumping'];
		tagOperations.both(showList, hideList);
		visualizeClusters.display();
		visualizeStarsInClusters.display();
	}
}


$(document).ready(function() {
	
	tagOperations.hideAll();
	$('#wrapperspace').show();
	
	$("#home").click(function(){
		window.location = "http://johntreddenlocal.com";
	});
	$("#listRenamedClusters").click(function(){
		parseRenameStream.cluster();
		
	});
	$("#listRenamedStars").click(function(){
		parseRenameStream.star();
	});
	$("#listRenamedPlanetoids").click(function(){
		parseRenameStream.planar();
	});

});


//for debugging
function print_recursive(printthis) {
    var output = '';

    if($.isArray(printthis) || typeof(printthis) == 'object') {
        for(var i in printthis) {
        	console.log("??:"+printthis[i]+"::"+i);
            output += i + ' : ' + print_recursive(printthis[i]) + '\n';
        }
    }else {
        output += printthis;
    }
    console.log("PRINT:"+output);
}
</script>

<title>Rename Cosmos Entity</title>
</head>


<section>
	<div id="spinner">
		<img src="./animatedEllipse.gif" />
	</div>
	<div id="spinner2"></div>
</section>



<body id="renameSpace">
	<div id="wrapperspace">
		<!--  wrapperspace -->
		<header id="topHeaderFixed">
			<hgroup>
				<nav>
					<button id="home">Home</button>
					<button id="listRenamedClusters">Travel to a named Cluster</button>
					<button id="listRenamedStars">Travel to a named Star</button>
					<button id="listRenamedPlanetoids">Travel to a named Planetoid</button>
				</nav>
			</hgroup>
		</header>
	</div>
</body>

<section id="start">
	<div id="space"></div>
</section>

<section id="renameText">

	<div id="column1" class="column"></div>
	<div id="column2" class="column"></div>

</section>




<section id="fsect">
	<div id="fdiv"></div>
</section>

</html>