<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<link href="../css/main.css" rel="stylesheet" type="text/css">

<script src="../js/jquery-3.0.0.min.js" type="text/javascript"></script>
<script type="text/javascript" src="../js/jquery.form.js"></script>
<script type="text/javascript" src="../js/buckets.js"></script>
<script type="text/javascript" src="../js/cosmosCommon.js"></script>
<script type="text/javascript">


/**
 * single line of renameable entity, new must be used
 */
var renameLine = (function(){
	
	// private
	
	var genericName;
	var entityType;
	var renamesArray = [];
	var renames_count = 0;
	
	//public
	
	return {
		setGenericName: function(name){
			genericName = name;
		},
		getGenericName: function(){
			return genericName;
		},
		setType: function(type){
			entityType = type;
		},
		getType: function(){
			return entityType;
		},
		addRename:  function(rename){
			renamesArray[renames_count] = rename;
			++renames_count;
		},
		getRenamesArray: function(){
			return renamesArray;
		}
	}
	
});

var displayButtons = (function (){
	
	// private
	
	function displayAction(start, end, tag, renameArray){
		var dynamicHtml = "";
		theXor = 0;
		for(var idex0 = start; idex0 < end; idex0++){
			var genericName = renameArray[idex0].getGenericName();
			var renames = [];
			renames = renameArray[idex0].getRenamesArray();
			var renameDisplay = "";
			for(var idex1 = 0; idex1 < renames.length; idex1++){
				if(0 == idex1){
					renameDisplay += renames[idex1];
				}
				else{
					renameDisplay += ",";
					renameDisplay += renames[idex1];
				}
			}
			
			theXor ^=1;
			var bgColor = "lightblue";
			if(theXor){
				bgColor = "lightgreen";
			}
			
			dynamicHtml +="<div class=\"entry\"><button onclick=\"entry.action("
					+ genericName + " "
					+ renameDisplay
					+")\" style=\"width: 100%; text-align: left; background-color:" + bgColor + ";"
					+"\">"
					+ "Generic Name: " + genericName
					+"</button></div>";
		}
		$("div[id^="+tag+"]").html(dynamicHtml);
	}
	
	// public
	return{
		action: function(renameArray){
			var wholeOfIt = renameArray.length;
			var firstHalf = Math.floor(wholeOfIt/2);

			displayAction(0, firstHalf, "column1", renameArray);
			displayAction(firstHalf+1, wholeOfIt, "column2", renameArray);

		}
	}
	
})();

var parseRenameStream  = (function(){
	
	// public
	
	return{
		cluster: function(){
			$.getJSON("http://www.localhost:8080/johntredden-1.0/listClusterRenameCandidates.html",
					function(json){           // callback
						console.log("in cluster:"+json);
						processChoice.jsonProcess(json);
					}
			);
			
		},
		star: function(){
			$.getJSON("http://www.localhost:8080/johntredden-1.0/listStarRenameCandidates.html",
					function(json){           // callback
						console.log("in star:"+json);
						processChoice.jsonProcess(json);
					}
			);
			
		},
		planar: function(){
			$.getJSON("http://www.localhost:8080/johntredden-1.0/listPlanetoidRenameCandidates.html",
					function(json){           // callback
						console.log("in planetoids:"+json);
						processChoice.jsonProcess(json);
					}
			);
			
		}
	}

}());

var processChoice = (function(){
	
	// public
	
	return {
		jsonProcess: function(json){
			var candidates = json.list[0];
			console.log(candidates);
			var lineArray = parseCandidates.parse(candidates);
			for (var idex in lineArray){
				
				var renameArray = lineArray[idex].getRenamesArray();
				console.log(lineArray[idex].getGenericName() + " "
						+ lineArray[idex].getType() + " ");
				for(var idex2 in renameArray){
					console.log( " " + renameArray[idex2] + " ");
				}
				
			}
			displayButtons.action(lineArray);
		}
	}
	
})();

var parseCandidates = (function(){
	
	var lineArray = [];
	var lineCount = 0;
	var workingRenameLine;
	var state;
	
	return{
		parse: function(stream){
			var output = '';
		    if($.isArray(stream) || typeof(stream) == 'object') {
		        for(var idex in stream) {
		        	switch(idex){
		        	case "genericName":
		        		state = 'start';
		        		workingRenameLine = new renameLine();
		        		break;
		        	
		        	case "renameObjectType":
		        		state = 'objectType';
		        		break;
		        		
		        	case "renames":
		        		state = 'renames';
		        		break;
		        	default:
		        		// probably object as name
		        	}
		        	parseCandidates.parse(stream[idex]);
		        }
		    }else {
		        output += stream;
		    }
		    if(output.length > 0){
		    	// console.log("state:" + state + " PRINT:"+output);
		    	switch (state){
		    	
		    	case "start":
		    		workingRenameLine.setGenericName(output);
		    		break;
		    		
		    	case "renames":
		    		workingRenameLine.addRename(output);
		    		break;
		    		
		    	case "objectType":
		    		workingRenameLine.setType(output);
		    		lineArray[lineCount++] = workingRenameLine;
		    		break;
		    		
		    	default:
		    		console.log("warning:" + state);
		    }
		 }
		 return lineArray;   
	   }
	}
	
})();



$(document).ready(function() {
	
	$("#home").click(function(){
		window.location = "http://johntreddenlocal.com";
	});
	$("#renameCluster").click(function(){
		parseRenameStream.cluster();
		
	});
	$("#renameStar").click(function(){
		parseRenameStream.star();
	});
	$("#renamePlanetoid").click(function(){
		parseRenameStream.planar();
	});

});


//for debugging
function print_recursive(printthis) {
    var output = '';

    if($.isArray(printthis) || typeof(printthis) == 'object') {
        for(var i in printthis) {
        	console.log("??:"+printthis[i]+"::"+i);
            output += i + ' : ' + print_recursive(printthis[i]) + '\n';
        }
    }else {
        output += printthis;
    }
    console.log("PRINT:"+output);
}
</script>

<title>Rename Cosmos Entity</title>
</head>

<body id="renameSpace">
	<div id="wrapperspace">
		<!--  wrapperspace -->
		<header id="topHeaderFixed">
			<hgroup>
				<nav id="topRenameCosmosEntity">
					<button id="home">Home</button>
					<button id="renameCluster">Rename a Cluster</button>
					<button id="renameStar">Rename a Star</button>
					<button id="renamePlanetoid">Rename a Planetoid</button>
				</nav>
			</hgroup>
		</header>
	</div>
</body>
</html>